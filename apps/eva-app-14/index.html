<!DOCTYPE html>
<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjY0ZjA3ZDcxOTc5ZjQzODI3MjJhOGRmMzQwNzUzY2UwZmVkOThjYTgiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxMjc1ODM2MTU4NDMzNTIyMzc4MCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiI2MzAyMjA1OGVjZWUtc3R1ZmZ5X3RpbWVzLmh0bWwtNDE3In0sImV4cCI6MTc3MTU2NjY4MywiaWF0IjoxNzcxNTYzMDgzLCJhbGciOiJSUzI1NiJ9.VX2anGxnAvII6iCg4TbmyImj3mlYUdXj0Gt3-OPoRn9ic5fbXpo0X__baIEVPRj0A8E5scl0floDxJQYeZc7qkV21DXpFQoREZGuBH_oGodtTxo5G3HZd9I_W34hWyO5cbaxOtrSE-pnDWbk3OZTiaqQOY86B9VxKGLO3XQZE0Ldpf3QWtfurCAtIgPGud_icmrZdCL4jfSipi5h0dOZ0UAtbYKIrgR_E4lYiRCSk0xsXs1dbGd1HQenbbBnkX1FY2k_L4lrOReT7KTzJsYkq4mcKjC4LSEFqcna5dtTY9A-IVaDscVT6cEdc4NFZ0jiXnDPraPcB2mejdYd7oQyIA","63022058ecee-stuffy_times.html-417")</script><script>(function(){'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
})();</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20","gemini-2.5-flash-preview-09-2025"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function(){'use strict';function a(){window.parent.postMessage({type:"interaction"},"*")}window.addEventListener("click",a,{capture:!0,passive:!0});window.addEventListener("touchstart",a,{capture:!0,passive:!0});window.addEventListener("keydown",a,{capture:!0,passive:!0});}).call(this);
</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The AI-Powered Stuffy Times üß∏üíñ</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the kawaii aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fef3f8 0%, #e0f7fa 100%); /* Soft pink to light blue gradient */
            min-height: 100vh;
        }
        /* Customizing Tailwind config for pastel colors */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kawaii-pink': '#FFC0CB',
                        'kawaii-blue': '#ADD8E6',
                        'kawaii-mint': '#C3F3E3',
                        'kawaii-lavender': '#E6E6FA',
                        'text-dark': '#3a3a5a',
                    }
                }
            }
        }
        /* Simple Spinner CSS */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FFC0CB;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .item-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .item-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(255, 192, 203, 0.5); /* Pink shadow on hover */
        }
        .discount-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #EF4444; /* Tailwind red-500 */
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 9999px; /* Full rounded */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transform: rotate(5deg);
        }
    </style>
</head>
<body class="p-4 md:p-8 text-text-dark antialiased">

    <!-- Header & Title -->
    <header class="text-center mb-8">
        <div class="inline-block p-4 bg-kawaii-pink shadow-xl rounded-[40px] border-4 border-white transform hover:scale-105 transition duration-300">
            <h1 class="text-5xl md:text-6xl font-extrabold text-white leading-none tracking-tight" style="text-shadow: 2px 2px 0px #F472B6;">
                üß∏ THE STUFFY TIMES üíñ
            </h1>
        </div>
        <!-- Dynamic Issue Info -->
        <p id="issue-info" class="mt-4 text-xl font-medium text-text-dark">
            <span class="inline-block bg-kawaii-lavender rounded-full px-3 py-1 shadow-md">
                Vol. X, Issue Y | Dynamic Day, 2025 | $Z.ZZ / Z Stuffy Bucks ‚ú®
            </span>
        </p>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-4xl mx-auto space-y-8">

        <!-- Main News Article (Dynamic) -->
        <article id="main-news" class="bg-white p-6 md:p-8 rounded-3xl shadow-2xl border-b-8 border-kawaii-blue">
            <!-- Content Injected Here -->
        </article>
        
        <!-- --- PLUSHIE MARKETPLACE CATALOG --- -->
        <section id="marketplace-catalog" class="bg-white p-6 md:p-8 rounded-3xl shadow-2xl border-b-8 border-kawaii-pink">
            <h2 class="text-3xl font-bold mb-6 text-center text-pink-500 flex items-center justify-center py-2 rounded-full bg-kawaii-mint">
                üõçÔ∏è The Plushie Marketplace - Today's Mega-Deals! üõí
            </h2>
            
            <div id="catalog-items" class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                <!-- Catalog Items Injected Here by JS -->
            </div>

            <!-- Item Detail/Confirmation Message Area -->
            <div id="catalog-message" class="mt-6 p-4 bg-kawaii-lavender rounded-xl shadow-inner border border-purple-300 hidden">
                <!-- Messages/Details appear here -->
            </div>
        </section>

        <!-- Side Columns: Forecast & Advice -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Snuggle Forecast (Dynamic) -->
            <section class="bg-kawaii-lavender p-6 rounded-3xl shadow-xl border-t-8 border-kawaii-pink">
                <h2 class="text-2xl font-bold mb-4 flex items-center text-text-dark">
                    ‚òÅÔ∏è Snuggle Forecast ‚òÄÔ∏è
                </h2>
                <p id="forecast-byline" class="text-sm italic mb-4 text-gray-600">
                    <!-- Byline Injected Here -->
                </p>

                <div class="overflow-x-auto">
                    <table class="w-full text-left bg-white rounded-xl overflow-hidden shadow-lg">
                        <thead class="bg-kawaii-pink text-white">
                            <tr>
                                <th class="p-3">Time</th>
                                <th class="p-3">Weather</th>
                                <th class="p-3">Mood Index</th>
                                <th class="p-3">Note</th>
                            </tr>
                        </thead>
                        <tbody id="forecast-body">
                            <!-- Rows Injected Here -->
                        </tbody>
                    </table>
                </div>
                <p id="forecast-tip" class="mt-4 p-2 bg-kawaii-pink text-white rounded-full text-center font-medium shadow-md">
                    <!-- Tip Injected Here -->
                </p>
            </section>

            <!-- Advice Column (Interactive & AI-Powered) -->
            <section class="bg-kawaii-mint p-6 rounded-3xl shadow-xl border-t-8 border-kawaii-lavender">
                <h2 class="text-2xl font-bold mb-4 flex items-center text-text-dark">
                    üéÄ Ask Penelope the Penguin üéÄ
                </h2>
                <p class="text-sm italic mb-4 text-gray-600">(Send your deepest stuffy secrets! üêß)</p>

                <!-- Q&A Response Area -->
                <div id="advice-qa-area">
                    <!-- Initial Random Q&A or User's Q&A will appear here -->
                </div>

                <!-- Input Form -->
                <form id="penelope-form" class="mt-4 p-4 bg-white rounded-xl shadow-md border-2 border-dashed border-purple-300">
                    <p class="font-bold text-xl mb-3 text-purple-600 flex items-center justify-center">
                        <span class="mr-2">üìù</span> Write Your Letter! 
                    </p>
                    
                    <label for="stuffy-name" class="block text-sm font-medium text-gray-700">Your Stuffy Name:</label>
                    <input type="text" id="stuffy-name" name="stuffy-name" placeholder="Fuzzy Wuzzy" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-kawaii-pink focus:border-kawaii-pink mb-3" required="">
                    
                    <label for="stuffy-letter" class="block text-sm font-medium text-gray-700">Your Question/Problem (be specific!):</label>
                    <textarea id="stuffy-letter" name="stuffy-letter" rows="4" placeholder="Dear Penelope, I have a problem..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-kawaii-pink focus:border-kawaii-pink mb-4" required=""></textarea>
                    
                    <button type="submit" id="submit-button" class="w-full py-2 px-4 bg-kawaii-pink text-white font-bold rounded-xl shadow-lg hover:bg-pink-400 transition duration-150 transform hover:scale-[1.02] active:scale-95">
                        Send to Penelope! üíå
                    </button>
                </form>
            </section>
        </div>

        <!-- Classified Corner (Now Dynamic!) -->
        <section id="classified-corner" class="bg-kawaii-blue p-6 md:p-8 rounded-3xl shadow-2xl border-b-8 border-white">
            <h2 class="text-3xl font-bold mb-4 flex items-center text-white justify-center py-2 rounded-full bg-blue-400">
                üß∂ Classified Corner üßµ
            </h2>
            <div id="classified-items" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <!-- Classified Ads Injected Here by JS -->
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center mt-12 mb-4 text-lg text-text-dark opacity-80">
        <p class="flex items-center justify-center space-x-2">
            <span>‚ú®</span>
            <span class="font-semibold">The Stuffy Times:</span>
            <span>All the News That's Fit to Snuggle.</span>
            <span>‚ú®</span>
        </p>
    </footer>

<script>
    // --- JS for Dynamic Content Generation & API Logic ---

    /** Utility function to get a random item from an array. */
    const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
    
    // --- WORD BANKS AND DATA STRUCTURES ---

    const wordBanks = {
        stuffySubjects: ["Mayor Squishington", "Barnaby the Badger", "Detective Buttons", "The Snuggle Patrol", "Pip the Puppy", "Fluffsmith Felix", "The Great Goose"],
        stuffyVerbs: ["discovered", "investigated", "declared a crisis", "won the race for", "organized a flash mob to find", "accidentally started", "successfully retrieved"],
        stuffyObjects: ["The Great Quilt", "missing button stash", "annual nap routine", "optimal pillow placement", "stolen yarn supply", "a hidden treat compartment", "the secret of perfect fluffiness"],
        stuffyOutcomes: ["and the town cheered!", "leading to immediate snuggles.", "which was unexpectedly delayed.", "but the solution remains elusive.", "restoring comfort levels by 99%.", "causing a brief moment of gentle panic.", "and all involved received a ribbon."],
        stuffyAdjectives: ["critical", "gentle", "missing", "annual", "supreme", "overdue", "patchwork"],
        stuffyLocation: ["Pillow Town", "The Grand Sleepy Meadow", "Felt-Hills County", "The Blanket Fort District", "The Seamstress Shop"],
        stuffyByline: ["Patches the Patchwork Puppy üêæ", "Zigzag the Zebra ü¶ì", "Buttons the Bear üêª", "Cotton the Cloud ‚òÅÔ∏è"],
        adviceProblemNouns: ["a sticky situation", "a case of accidental rolling", "the fear of the vacuum", "a loose thread anxiety", "a mysterious stuffing leak", "too much sunlight exposure", "a critical case of flat-ear syndrome"],
        forecastWeather: ["Gentle Snores üò¥", "Soft Sunshine ‚òÄÔ∏è", "Cushion Fog üå´Ô∏è", "Light Drizzles üíß", "Weighted Blanket üåô", "Patchwork Showers ‚òî"],
        forecastMood: ["Cozy", "Warm", "Very Cozy", "Chilly", "Snuggly", "Optimistic", "Fuzzy"],
        forecastNote: ["Perfect for lying still.", "Ideal for window naps.", "Time for extra hugs.", "Watch out for shadows.", "100% Chance of Deep Snuggles.", "Recharge your internal fluff.", "A great day for hiding."],
        forecastTip: ["Remember to fluff your friend today!", "Don't forget your favorite blanket accessory!", "Check your seams for loose threads!", "Hydrate with a tiny drop of dew!", "Try a new napping position!"],
        issueDay: ["Cuddle Day ‚òÅÔ∏è", "Snooze Tuesday üí§", "Fleece Friday üêë", "Ribbon Wednesday üéÄ", "Patchwork Saturday üßµ", "Button Day üîò", "Seam Sunday ‚ú®"],
        
        // --- Classifieds Word Banks ---
        lostItems: ["button eye", "favorite squeaker", "small, knitted hat", "one sock (left side only)", "a shiny pebble of great importance", "a special lavender-scented tag"],
        lostLocations: ["near the bottom of the laundry hamper", "under the sofa cushion", "in the deep, dark corner of the closet", "by the window sill at dawn", "behind the bookshelf"],
        rewards: ["three (3) excellent back-scratches", "a share of the next treat", "unlimited access to the best pillow", "a new ribbon (color of choice)", "a fresh stuffing refill"],
        
        wantedItems: ["Experienced Bedtime Buddy", "Professional Fluff-Fluffer", "Seamstress for Hire (no questions asked)", "Quiet Companion for Reading Naps", "Security Snuggler for Night Shifts"],
        wantedConditions: ["Must be able to withstand mild tumbling", "Requires excellent listening skills", "Strictly no static electricity", "Must possess deep, even stuffing", "No small parts"],
        
        forSaleItems: ["Hand-knitted tiny scarf", "Gently used hug coupon book", "A perfectly smooth worry stone", "Set of 5 custom replacement whiskers", "Oversized felt map of the bedroom"],
        forSaleNotes: ["Never worn, only gently admired", "Excellent condition, slight lavender scent", "One careful owner, ready for a new nap spot", "Guaranteed to reduce stress by 10%"],
        
        contactStuffy: ["Patches the Bunny. üê∞", "Zigzag the Zebra. ü¶ì", "Buttons the Bear. üêª", "Cotton the Cloud. ‚òÅÔ∏è", "Pip the Penguin. üêß"],
    };


    let currentCatalogItems = []; // Global variable to hold generated items for the current session

    /** Generates a new, random list of 4 unique catalog items with discounts. */
    function generateCatalogItems() {
        const itemIcons = ["&#x1f58c;", "&#x1f9f5;", "&#x1faa8;", "&#x1f380;", "&#x1f9e2;", "&#x1f9f9;", "&#x1f34b;", "&#x1f452;", "&#x1f9e9;", "&#x1f9f3;"]; // Brush, Thread, Rock, Ribbon, Hat, Sponge, Lemon, Purse, Jigsaw, Spool
        const itemNames = ["Fluff Rejuvenator", "Tangle Mender Thread", "Gravity Pebble Set", "Anxiety Shield Ribbon", "The Dream Nightcap", "Dust Bunny Slayer", "Squeak Silencer", "Miniature Snack Pouch", "Worry Quilt Piece", "Extra Strength Seam Spool"];
        const itemDescriptions = [
            "Restores lost volume and bounce. Say goodbye to flat spots!", 
            "Tiny needle and thread for quick, discreet repairs. Essential for adventurous plushies.", 
            "A smooth, tiny weight for internal pockets to prevent rolling off the bed at night.", 
            "A soft barrier that repels shadows and bad thoughts, woven with calm.", 
            "A comfortable, weighted cap for maximum focus on sleeping and deep rest.", 
            "A gentle, tiny sponge that absorbs dust and small debris without scratching.", 
            "A small, cloth-wrapped item that absorbs squeaks from moving joints.",
            "Perfectly sized pouch for carrying tiny treats or secrets.",
            "A single, soft patch to repair holes or add charm to your favorite blanket.",
            "High-tensile thread, essential for keeping the most active limbs attached."
        ];
        const itemAdjectives = ["Supreme", "Ultra-Soft", "Hand-Dyed", "Limited Edition", "Cozy", "Durable", "Weighted"];
        
        const items = [];
        const count = 4;
        
        const usedCombinations = new Set();

        while (items.length < count) {
            const baseIndex = Math.floor(Math.random() * itemNames.length);
            const adj = getRandom(itemAdjectives);
            
            const uniqueName = `${adj} ${itemNames[baseIndex]}`;
            
            if (usedCombinations.has(uniqueName)) continue;
            usedCombinations.add(uniqueName);

            // Calculate Prices and Discount
            const basePrice = Math.floor(Math.random() * 81) + 20; // 20 to 100 Stuffy Bucks
            const discountPercent = Math.floor(Math.random() * 71) + 10; // 10% to 80% discount
            const finalPrice = Math.round(basePrice * (1 - discountPercent / 100));
            
            const color = getRandom(['kawaii-pink', 'kawaii-blue', 'kawaii-mint', 'kawaii-lavender']);

            items.push({
                id: items.length + 1,
                name: uniqueName,
                baseName: itemNames[baseIndex], // Store the shorter base name here
                basePrice: basePrice,
                discountPercent: discountPercent,
                finalPrice: finalPrice,
                desc: itemDescriptions[baseIndex],
                icon: itemIcons[baseIndex],
                color: color
            });
        }
        return items;
    }


    // --- AI-POWERED ADVICE COLUMN LOGIC (UNCHANGED) ---

    const apiKey = "";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
    const maxRetries = 3;
    const initialDelay = 1000;

    /** Shows a loading spinner in the Q&A area. */
    function showLoadingState(userName, userQuestion) {
        const questionHTML = `
            <p class="font-bold text-lg mb-2">Dear Penelope,</p>
            <p class="text-base mb-3">${userQuestion}</p>
            <p class="text-right text-gray-500 italic">‚Äì ${userName}</p>
        `;

        document.getElementById('advice-qa-area').innerHTML = `
            <div class="bg-white p-4 rounded-xl shadow-inner mb-4">
                <p class="text-center font-bold text-gray-500 mb-2 text-sm italic">-- Your Letter Published Below! --</p>
                ${questionHTML}
            </div>
            <div id="penelope-loading" class="flex flex-col items-center justify-center p-6 bg-kawaii-pink bg-opacity-10 rounded-xl shadow-md border border-kawaii-pink">
                <div class="spinner mb-3"></div>
                <p class="text-pink-600 font-semibold">Penelope is pondering your problem... (Consulting her wise old seamstress book!)</p>
            </div>
        `;
        document.getElementById('submit-button').disabled = true;
        document.getElementById('submit-button').textContent = 'Sending...';
    }
    
    /** Hides the loading spinner and re-enables the button. */
    function hideLoadingState() {
        document.getElementById('submit-button').disabled = false;
        document.getElementById('submit-button').textContent = 'Send to Penelope! üíå';
    }


    /** Fetches advice from the Gemini API (Penelope's brain). */
    async function fetchPenelopeAdvice(userName, userQuestion) {
        const systemPrompt = `You are Penelope the Penguin, the wise, soft, and extremely kawaii advice columnist for The Stuffy Times newspaper. Your tone must be excessively supportive, gentle, and adorable, using emojis (üíñ‚ú®üß∏) liberally. Answer the reader's question directly, providing a specific, actionable piece of advice that is relevant to stuffies, plush toys, or inanimate objects (e.g., about seam rips, being lost, noisy joints, dust bunnies, or owner placement). Keep the response concise (max 3 sentences) and sign off with a loving phrase.`;
        
        const userQuery = `Dear Penelope, my name is ${userName} and my problem is: ${userQuestion}`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: {
                parts: [{ text: systemPrompt }]
            },
        };

        for (let attempt = 0; attempt < maxRetries; attempt++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API returned status ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    return text;
                } else {
                    throw new Error("API response text was empty or malformed.");
                }

            } catch (error) {
                console.error(`Attempt ${attempt + 1} failed:`, error);
                if (attempt < maxRetries - 1) {
                    await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, attempt)));
                } else {
                    throw new Error("Penelope's connection to the wisdom flow failed after multiple retries. Try again!");
                }
            }
        }
    }

    /** Generates Penelope's response based on user input and AI analysis. */
    async function generatePenelopeResponse(userName, userQuestion) {
        showLoadingState(userName, userQuestion);
        
        let penelopeResponse = "Oh dear, Penelope seems to be stuck in a blanket fort! Try sending your letter again later. üß∏";

        try {
            penelopeResponse = await fetchPenelopeAdvice(userName, userQuestion);
        } catch (e) {
            console.error("Failed to get AI response:", e);
            penelopeResponse = e.message.includes("failed") ? e.message : "My dearest, a tiny internet glitch happened! Please give me a second chance! ‚ú®";
        } finally {
            hideLoadingState();
        }

        const responseHTML = `
            <p class="font-bold text-lg mb-2 text-pink-600">Dear ${userName},</p>
            <p class="text-base mb-3">${penelopeResponse}</p>
        `;

        const qaArea = document.getElementById('advice-qa-area');
        
        const loadingDiv = document.getElementById('penelope-loading');
        if (loadingDiv) {
            loadingDiv.className = "bg-kawaii-pink bg-opacity-10 p-4 rounded-xl shadow-md border border-kawaii-pink";
            loadingDiv.id = "penelope-answer";
            loadingDiv.innerHTML = responseHTML;
        } else {
             qaArea.innerHTML += `<div class="bg-kawaii-pink bg-opacity-10 p-4 rounded-xl shadow-md border border-kawaii-pink">${responseHTML}</div>`;
        }
        
        qaArea.innerHTML += `<p class="text-center text-sm mt-2 text-gray-500">üíå Your custom reply is here! You can send another letter using the form below.</p>`;
    }

    /** Generates the initial random content for the advice column. */
    function generateInitialRandomAdvice() {
        const problemNoun = getRandom(wordBanks.adviceProblemNouns);
        const questioner = `${getRandom(["Fuzzy", "Squishy", "Cotton", "Tiny"])} and ${getRandom(["Worried", "Chilled", "Confused"])} in Felt Town`;
        
        const question = `Dear Penelope, I have a recurring problem with ${problemNoun}. How can I feel safe and snuggly again?`;
        const answer = `Oh dear, ${problemNoun} can be a tricky thing! Remember to always prioritize your internal fluff integrity. Try locating the nearest warm spot for a scheduled 15-minute relaxation session. A cozy environment solves most unexpected jitters! Keep it Cozy! üíñ`;
        
        const responseHTML = `
            <p class="font-bold text-lg mb-2 text-pink-600">Dear Stuffy,</p>
            <p class="text-base mb-3">${answer}</p>
        `;

        const questionHTML = `
            <p class="font-bold text-lg mb-2">Dear Penelope,</p>
            <p class="text-base mb-3">${question}</p>
            <p class="text-right text-gray-500 italic">‚Äì ${questioner}</p>
        `;
        
        const qaArea = document.getElementById('advice-qa-area');
        qaArea.innerHTML = `
            <div class="bg-white p-4 rounded-xl shadow-inner mb-4">
                <p class="text-center font-bold text-gray-500 mb-2 text-sm italic">-- A Random Letter from a Fellow Stuffy --</p>
                ${questionHTML}
            </div>
            <div class="bg-kawaii-pink bg-opacity-10 p-4 rounded-xl shadow-md border border-kawaii-pink">${responseHTML}</div>
            <p class="text-center text-sm mt-2 text-gray-500">Submit your own letter below to get a custom AI-Powered reply!</p>
        `;
    }

    /** Handles the form submission from the user. */
    function handlePenelopeSubmission(event) {
        event.preventDefault();

        const nameInput = document.getElementById('stuffy-name');
        const letterInput = document.getElementById('stuffy-letter');
        
        const userName = nameInput.value.trim() || "A Dear Reader";
        const userQuestion = letterInput.value.trim();

        if (userQuestion.length > 10) {
            generatePenelopeResponse(userName, userQuestion);
            nameInput.value = '';
            letterInput.value = '';
        } else {
            const qaArea = document.getElementById('advice-qa-area');
            qaArea.innerHTML = `<div class="p-3 bg-red-100 text-red-700 font-semibold text-center rounded-xl">ü•∫ Penelope needs a little more detail (at least 10 characters) to give the best advice! Please write a longer question.</div>`;
        }
    }


    // --- 3. MARKETPLACE CATALOG LOGIC ---

    /** Renders the catalog items to the DOM. */
    function renderCatalog(items) {
        currentCatalogItems = items; // Store for use in showItemDetail/confirmPurchase
        const container = document.getElementById('catalog-items');
        container.innerHTML = '';

        items.forEach(item => { 
            // Calculate dollar prices for display
            const baseDollarPrice = (item.basePrice / 10).toFixed(2);
            const finalDollarPrice = (item.finalPrice / 10).toFixed(2);
            
            const itemElement = document.createElement('div');
            itemElement.className = `item-card p-3 rounded-xl shadow-lg bg-white border-b-4 border-${item.color}-300 hover:border-kawaii-pink relative`;
            itemElement.setAttribute('data-item-id', item.id);
            
            itemElement.innerHTML = `
                <div class="discount-badge">-${item.discountPercent}%</div>
                <div class="text-4xl text-center mb-1" style="line-height: 1.2;">${item.icon}</div> 
                <!-- Using the shorter baseName for the catalog card view -->
                <p class="font-bold text-sm text-center text-text-dark truncate">${item.baseName}</p>
                <div class="text-center mt-1">
                    <!-- Original Price (SB and $) -->
                    <span class="text-xs text-gray-400 line-through mr-1">$${baseDollarPrice} / ${item.basePrice} SB</span>
                    <br class="sm:hidden" />
                    <!-- Final Price (SB and $) -->
                    <span class="text-sm font-extrabold text-red-500">$${finalDollarPrice}</span>
                    <span class="text-xs font-semibold text-text-dark"> / </span>
                    <span class="text-sm font-extrabold text-red-500">${item.finalPrice}</span>
                    <span class="text-xs font-semibold text-pink-500">SB</span>
                </div>
            `;
            itemElement.addEventListener('click', () => showItemDetail(item));
            container.appendChild(itemElement);
        });
    }

    /** Shows the detail/confirmation message when an item is clicked. */
    function showItemDetail(item) {
        const messageArea = document.getElementById('catalog-message');
        messageArea.classList.remove('hidden');

        // Calculate dollar prices for detail display
        const baseDollarPrice = (item.basePrice / 10).toFixed(2);
        const finalDollarPrice = (item.finalPrice / 10).toFixed(2);

        messageArea.innerHTML = `
            <!-- Using the full name here for detail -->
            <h3 class="font-extrabold text-xl text-pink-700 mb-2">${item.name}</h3> 
            <p class="text-sm italic text-gray-700 mb-3">${item.desc}</p>
            
            <p class="font-bold text-lg text-text-dark mb-3">
                Original Price: 
                <span class="text-gray-500 line-through">$${baseDollarPrice} / ${item.basePrice} Stuffy Bucks</span>
            </p>
            
            <p class="font-bold text-xl text-text-dark mb-3">
                Today's Price (${item.discountPercent}% OFF!): 
                <span class="text-red-500">$${finalDollarPrice}</span> 
                <span class="text-text-dark"> / </span>
                <span class="text-red-500">${item.finalPrice} Stuffy Bucks</span>
            </p>
            
            <button onclick="confirmPurchase(${item.id})" class="w-full py-2 bg-pink-500 text-white font-bold rounded-lg shadow-md hover:bg-pink-400 transition duration-150">
                Purchase Now! (Mock) üõí
            </button>
        `;
    }

    /** Mock purchase function to show a success message. */
    window.confirmPurchase = function(itemId) {
        const item = currentCatalogItems.find(i => i.id === itemId);
        const messageArea = document.getElementById('catalog-message');

        const finalDollarPrice = (item.finalPrice / 10).toFixed(2);

        messageArea.innerHTML = `
            <div class="text-center">
                <p class="text-3xl mb-2">üéâ</p>
                <h3 class="font-extrabold text-xl text-green-600 mb-1">Purchase Confirmed!</h3>
                <p class="text-base text-gray-700">Thank you for ordering the <span class="font-bold">${item.name}</span>! Your $${finalDollarPrice} / ${item.finalPrice} Stuffy Bucks have been debited. It will arrive in your nap spot soon. Happy Snuggling! üíñ</p>
            </div>
        `;
    }


    // --- 4. Main Newspaper Generation Logic ---

    /** Generates a full news article using random word combinations. */
    function generateNewsArticle() {
        const subject = getRandom(wordBanks.stuffySubjects);
        const verb = getRandom(wordBanks.stuffyVerbs);
        const object = getRandom(wordBanks.stuffyObjects);
        const outcome = getRandom(wordBanks.stuffyOutcomes);
        const adjective = getRandom(wordBanks.stuffyAdjectives);
        const location = getRandom(wordBanks.stuffyLocation);
        const byline = getRandom(wordBanks.stuffyByline);

        const title = `${adjective.toUpperCase()} ${object.toUpperCase()} ${verb.toUpperCase()}!`;
        const subtitle = `${subject} ${verb.toLowerCase()} the ${adjective} ${object}!`;
        const bodyPart1 = `${location} ‚Äì Panic was averted this morning after ${subject} ${verb} the ${object}. The situation had been deemed ${adjective}, threatening ${getRandom(['the quiet comfort', 'the general fluff supply', 'the scheduled nap time'])}.`;
        const bodyPart2 = `The star of the event, ${getRandom(['a tiny blue bunny', 'a brave teddy bear', 'Fluffsmith Felix'])}, confirmed that the recovery was ${outcome.replace('!', '')}. All residents are encouraged to stay safe and secure their ${object.split(' ').pop()}.`;

        return {
            title,
            subtitle,
            byline,
            bodyPart1,
            bodyPart2
        };
    }

    /** Generates the forecast content. */
    function generateForecast() {
        const forecastBody = document.getElementById('forecast-body');
        forecastBody.innerHTML = '';
        document.getElementById('forecast-byline').textContent = `(By ${getRandom(['Sunny the Sun Bear', 'Cloudy the Sheep', 'Breeze the Bunny'])} ‚òÅÔ∏è)`;
        document.getElementById('forecast-tip').textContent = `üíñ TIP: ${getRandom(wordBanks.forecastTip)}`;

        // Generate 4 unique forecast entries
        const times = ["Dawn Naps", "Mid-day Slump", "Afternoon Cuddles", "Lights Out"];
        for (let i = 0; i < 4; i++) {
            const time = times[i];
            const weather = getRandom(wordBanks.forecastWeather);
            const mood = getRandom(wordBanks.forecastMood);
            const note = getRandom(wordBanks.forecastNote);
            
            const row = document.createElement('tr');
            row.className = i % 2 === 0 ? 'border-b border-gray-100' : 'border-b border-gray-100 bg-gray-50';
            row.innerHTML = `
                <td class="p-3">${time}</td>
                <td class="p-3">${weather}</td>
                <td class="p-3 ${mood === 'Very Cozy' ? 'text-pink-500 font-semibold' : ''}">${mood}</td>
                <td class="p-3">${note}</td>
            `;
            forecastBody.appendChild(row);
        }
    }
    
    /** Generates the dynamic classified advertisements. */
    function generateClassifieds() {
        const classifiedsContainer = document.getElementById('classified-items');
        classifiedsContainer.innerHTML = ''; // Clear existing content

        const ads = [
            { // LOST Ad
                title: "LOST üîç",
                titleColor: "red-500",
                borderColor: "red-300",
                text: `One (1) ${getRandom(wordBanks.lostItems)}, ${getRandom(['brightly colored', 'velvety soft', 'slightly worn'])}. Last seen ${getRandom(wordBanks.lostLocations)}. Reward: ${getRandom(wordBanks.rewards)}. Contact ${getRandom(wordBanks.contactStuffy)}`
            },
            { // WANTED Ad
                title: "WANTED ü§ù",
                titleColor: "green-500",
                borderColor: "green-300",
                text: `${getRandom(wordBanks.wantedItems)} needed. Must be able to ${getRandom(wordBanks.wantedConditions).toLowerCase()} and provide ${getRandom(['excellent', 'gentle', 'firm'])} forehead comfort. Apply within. Must love naps. üò¥`
            },
            { // FOR SALE Ad
                title: "FOR SALE üõçÔ∏è",
                titleColor: "purple-500",
                borderColor: "purple-300",
                text: `${getRandom(wordBanks.forSaleItems)}, perfectly sized for a small friend. ${getRandom(wordBanks.forSaleNotes)}. Priced to sell quickly! üè∑Ô∏è`
            }
        ];

        ads.forEach(ad => {
            const adElement = document.createElement('div');
            adElement.className = `bg-white p-4 rounded-xl shadow-md border-2 border-dashed border-${ad.borderColor}`;
            adElement.innerHTML = `
                <p class="font-bold text-${ad.titleColor} text-xl mb-1">${ad.title}</p>
                <p>${ad.text}</p>
            `;
            classifiedsContainer.appendChild(adElement);
        });
    }


    /** Main function to generate the newspaper content on load. */
    function generateNewspaper() {
        // --- 1. Issue Details (Uses Stuffy Bucks and Dollars) ---
        const issue = {
            vol: Math.floor(Math.random() * 9) + 1,
            issue: Math.floor(Math.random() * 99) + 1,
            cost: Math.floor(Math.random() * 20) + 5
        };
        const today = new Date();
        const day = getRandom(wordBanks.issueDay);
        
        // Calculate dollar cost
        const dollarCost = (issue.cost / 10).toFixed(2);

        document.getElementById('issue-info').innerHTML = `
            <span class="inline-block bg-kawaii-lavender rounded-full px-3 py-1 shadow-md">
                Vol. ${issue.vol}, Issue ${issue.issue} | ${day}, ${today.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} | $${dollarCost} / ${issue.cost} Stuffy Bucks ‚ú®
            </span>
        `;

        // --- 2. Main News Article ---
        const articleData = generateNewsArticle();
        document.getElementById('main-news').innerHTML = `
            <div class="text-4xl mb-4">üö® ${articleData.title} üö®</div>
            <h2 class="text-3xl font-bold mb-4 text-pink-500">${articleData.subtitle}</h2>
            <p class="text-sm italic mb-4 text-gray-500">(${articleData.byline})</p>
            
            <p class="text-lg leading-relaxed mb-4">
                ${articleData.bodyPart1}
            </p>

            <div class="flex items-center justify-center p-3 my-4 bg-kawaii-mint rounded-xl shadow-inner">
                <span class="text-xl font-semibold text-text-dark">
                    Urgent Alert: ${getRandom(['The Great Quilt is safe.', 'Fluff levels are optimal.', 'Nap time is on schedule.'])} üåü
                </span>
            </div>

            <p class="text-lg leading-relaxed">
                ${articleData.bodyPart2} üßµ
            </p>
        `;

        // --- 3. Snuggle Forecast ---
        generateForecast();

        // --- 4. Marketplace Catalog (Dynamic with Discounts) ---
        const freshCatalog = generateCatalogItems();
        renderCatalog(freshCatalog);
        
        // --- 5. Classifieds (NEW Dynamic Content) ---
        generateClassifieds();

        // --- 6. Advice Column Setup ---
        generateInitialRandomAdvice();
        
        // Set up the form listener
        document.getElementById('penelope-form').addEventListener('submit', handlePenelopeSubmission);
    }

    // Run the function when the page loads
    window.onload = generateNewspaper;

</script>


</body></html>