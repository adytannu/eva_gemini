<!DOCTYPE html>
<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjY0ZjA3ZDcxOTc5ZjQzODI3MjJhOGRmMzQwNzUzY2UwZmVkOThjYTgiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxMjc1ODM2MTU4NDMzNTIyMzc4MCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiI5M2VhOWFmYTE0YjQtaW5kZXguaHRtbC01NDQifSwiZXhwIjoxNzcxNTY2Njk3LCJpYXQiOjE3NzE1NjMwOTcsImFsZyI6IlJTMjU2In0.cPjIYHEeJOFS18o5PTJMcRV3Aj8yp4ZhHL5LcWaZTCZXDKJpaFc3SjZfNdvKyg3P5QPFoKu_5bklJLGr8JXMisxO9i88Z3L-GHJveMyuExxLcR3nxgkbdwjEfoKaB-ipwD7_JwDMeyh9_fb5MVHNJ2u5GDMo5qI9mNiETr0s91zmloGXD98a4oENYgEJUtm9p8FV4C8BcGoh20Ed37rEXVTZM_i-3VNF-L-NsnQHlgo62gR3yTmHGTnSMxv83lybaW_5wL1WCAHmsxhnEft_DpqeNKap25bpxaFYrE7KYT02BcKcRu3g-27Cuz1RE40VNrq3o0Q2-yl2nl8QKewy-A","93ea9afa14b4-index.html-544")</script><script>(function(){'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
})();</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20","gemini-2.5-flash-preview-09-2025"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function(){'use strict';function a(){window.parent.postMessage({type:"interaction"},"*")}window.addEventListener("click",a,{capture:!0,passive:!0});window.addEventListener("touchstart",a,{capture:!0,passive:!0});window.addEventListener("keydown",a,{capture:!0,passive:!0});}).call(this);
</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kawaii Cosmetics Corner üéÄ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fce7f3; /* Light Pink Background */
        }
        .scroll-hidden::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="text-center py-6 sm:py-10 bg-white shadow-xl rounded-2xl mb-8 border-4 border-pink-300">
            <h1 class="text-4xl sm:text-6xl font-extrabold text-pink-600 tracking-tight">
                Kawaii Cosmetics Corner üíñ
            </h1>
            <p class="text-lg sm:text-xl text-purple-500 mt-2 font-medium">
                Your daily dose of cute beauty essentials! ‚ú®
            </p>
        </header>

        <!-- Dynamic Sale Banner -->
        <div id="sale-banner" class="p-4 sm:p-6 mb-8 text-center rounded-xl shadow-lg transform hover:scale-[1.01] transition duration-300 ease-in-out cursor-pointer bg-gradient-to-r from-yellow-300 to-pink-400">
            <h2 id="sale-title" class="text-xl sm:text-3xl font-bold text-white uppercase tracking-wider">
                Loading Today's Magic... ü™Ñ
            </h2>
            <p id="sale-description" class="text-sm sm:text-lg text-yellow-100 mt-1">
                Refresh to see the surprise!
            </p>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">

            <!-- Product List -->
            <main class="md:col-span-3">
                <h2 class="text-2xl font-bold text-pink-700 mb-6 border-b-2 border-pink-300 pb-2">Our Full Collection (30 Items)</h2>
                <div id="product-list" class="grid grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                    <!-- Products will be injected here by JavaScript -->
                </div>
            </main>

            <!-- Cart Sidebar -->
            <aside class="md:col-span-1 sticky top-8 h-fit">
                <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-xl border-4 border-purple-300">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h3 class="text-xl font-bold text-purple-600">Your Cart üõí</h3>
                        <span id="cart-count" class="bg-pink-500 text-white text-xs font-semibold px-2 py-1 rounded-full">0</span>
                    </div>

                    <div id="cart-items" class="h-64 overflow-y-auto scroll-hidden mb-4 space-y-3">
                        <p class="text-gray-500 text-sm italic" id="empty-cart-message">Your basket is empty. Add some sparkle! ‚ú®</p>
                        <!-- Cart items will be rendered here -->
                    </div>

                    <!-- Totals -->
                    <div class="space-y-2 pt-4 border-t border-purple-100">
                        <div class="flex justify-between text-sm text-gray-700">
                            <span>Subtotal:</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        <div class="flex justify-between text-base font-semibold text-red-500">
                            <span>Sale Discount:</span>
                            <span id="discount">-$0.00</span>
                        </div>
                        <div class="flex justify-between text-lg font-bold text-pink-600 pt-2 border-t border-purple-200">
                            <span>Total:</span>
                            <span id="total">$0.00</span>
                        </div>
                    </div>

                    <button onclick="checkout()" class="w-full mt-6 py-3 bg-pink-500 hover:bg-pink-600 text-white font-bold rounded-xl shadow-lg transition duration-200 transform hover:scale-[1.02]">
                        Checkout Now! ü•≥
                    </button>
                    <button onclick="clearCart()" class="w-full mt-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-600 font-medium rounded-xl transition duration-200">
                        Clear Cart
                    </button>
                </div>
            </aside>
        </div>
    </div>

    <!-- Custom Alert/Modal -->
    <div id="modal-container" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center border-4 border-pink-500 transform scale-0 transition-transform duration-300" id="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold text-pink-600 mb-4">Notification</h3>
            <p id="modal-text" class="text-gray-700 mb-6">Message content.</p>
            <button onclick="closeModal()" class="py-2 px-6 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg transition duration-200">
                Got It! üëç
            </button>
        </div>
    </div>

    <script>
        // --- DATA AND INITIAL SETUP ---

        const productData = [
            { id: 1, name: "Cloud Cushion Foundation", category: "Face", price: 29.99, icon: "‚òÅÔ∏è", desc: "Feather-light coverage for a flawless look." },
            { id: 2, name: "Starry Night Palette", category: "Eyes", price: 45.00, icon: "‚ú®", desc: "12 shimmering shades inspired by the cosmos." },
            { id: 3, name: "Strawberry Lip Balm", category: "Lip", price: 8.50, icon: "üçì", desc: "Sweet, moisturizing balm with a hint of tint." },
            { id: 4, name: "Peach Smoothie Primer", category: "Face", price: 22.00, icon: "üçë", desc: "Blurs pores and preps skin for makeup." },
            { id: 5, name: "Sparkle Pop Gloss", category: "Lip", price: 12.99, icon: "üç≠", desc: "High-shine, non-sticky lip gloss." },
            { id: 6, name: "Mint Clay Mask", category: "Skincare", price: 18.00, icon: "üåø", desc: "Detoxifying mask for a deep clean." },
            { id: 7, name: "Lavender Setting Spray", category: "Face", price: 15.99, icon: "üíú", desc: "Locks makeup in place all day long." },
            { id: 8, name: "Bunny Blush Duo", category: "Cheeks", price: 24.50, icon: "üê∞", desc: "Two perfect rosy shades for a natural flush." },
            { id: 9, name: "Mermaid Eyeliner", category: "Eyes", price: 14.00, icon: "üßú‚Äç‚ôÄÔ∏è", desc: "Vibrant blue liquid liner with shimmer." },
            { id: 10, name: "Coconut Body Scrub", category: "Skincare", price: 21.00, icon: "ü••", desc: "Exfoliates gently for silky soft skin." },
            { id: 11, name: "Lemon Glow Serum", category: "Skincare", price: 35.00, icon: "üçã", desc: "Vitamin C packed serum for a bright glow." },
            { id: 12, name: "Rainbow Highlighter", category: "Face", price: 31.99, icon: "üåà", desc: "Prismatic highlighter for an ethereal sheen." },
            { id: 13, name: "Puppy Paw Contour", category: "Cheeks", price: 26.00, icon: "üêæ", desc: "Cream contour stick in universal shades." },
            { id: 14, name: "Bubblegum Pink Polish", category: "Nails", price: 7.00, icon: "üíÖ", desc: "Long-lasting, quick-dry nail lacquer." },
            { id: 15, name: "Kitty Cat Mascara", category: "Eyes", price: 19.99, icon: "üê±", desc: "Volumizing and lengthening black mascara." },
            { id: 16, name: "Honey & Oat Cleanser", category: "Skincare", price: 16.50, icon: "üçØ", desc: "Soothing wash for sensitive skin." },
            { id: 17, name: "Grape Soda Stain", category: "Lip", price: 11.00, icon: "üçá", desc: "Long-wear purple-pink lip and cheek stain." },
            { id: 18, name: "Glitter Bomb Shadow", category: "Eyes", price: 9.99, icon: "üí•", desc: "Single pot of loose pressed glitter." },
            { id: 19, name: "Unicorn Horn Brush Set", category: "Tools", price: 55.00, icon: "ü¶Ñ", desc: "10-piece professional synthetic brush collection." },
            { id: 20, name: "Dewdrop Tinted Moisturizer", category: "Face", price: 27.00, icon: "üíß", desc: "Light coverage and hydration in one." },
            { id: 21, name: "Cactus Water Toner", category: "Skincare", price: 20.00, icon: "üåµ", desc: "Hydrating and balancing facial toner." },
            { id: 22, name: "Firefly Bronze Powder", category: "Cheeks", price: 33.00, icon: "üî•", desc: "Warm bronzer with a subtle golden shimmer." },
            { id: 23, name: "Dino Egg Sponge", category: "Tools", price: 5.00, icon: "ü¶ñ", desc: "Blend your foundation perfectly with this unique sponge." },
            { id: 24, name: "Rose Water Mist", category: "Skincare", price: 13.99, icon: "üåπ", desc: "Refreshing mist for instant skin hydration." },
            { id: 25, name: "Hot Cocoa Lipstick", category: "Lip", price: 17.50, icon: "‚òï", desc: "Rich, creamy matte brown lipstick." },
            { id: 26, name: "Galaxy Nail Art Kit", category: "Nails", price: 15.00, icon: "üåå", desc: "Everything you need for a celestial manicure." },
            { id: 27, "name": "Ocean Eyeshadow Stick", category: "Eyes", price: 18.00, icon: "üåä", desc: "Waterproof cream eyeshadow stick." },
            { id: 28, "name": "Rainbow Pouch", category: "Tools", price: 14.99, icon: "„Éù„Éº„ÉÅ", desc: "Small zippered pouch for all your cosmetics." },
            { id: 29, "name": "Fluffy Eyebrow Gel", category: "Eyes", price: 10.50, icon: "‚òÅÔ∏è", desc: "Clear gel to set your brows in place." },
            { id: 30, "name": "Cherry Pop Red", category: "Lip", price: 16.99, icon: "üçí", desc: "Classic bold red matte liquid lipstick." }
        ];

        let cart = [];
        let currentSale = {};
        const MAX_RETRIES = 5;

        // --- UTILITY FUNCTIONS ---

        function showModal(title, text) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-text').textContent = text;
            document.getElementById('modal-container').classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                document.getElementById('modal-content').classList.remove('scale-0');
                document.getElementById('modal-content').classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            // Animate out
            document.getElementById('modal-content').classList.remove('scale-100');
            document.getElementById('modal-content').classList.add('scale-0');
            setTimeout(() => {
                document.getElementById('modal-container').classList.add('hidden');
            }, 300);
        }

        function formatCurrency(amount) {
            return `$${amount.toFixed(2)}`;
        }

        // --- SALE LOGIC ---

        function defineSale() {
            const sales = [
                // 1. General Percentage Discount
                {
                    type: "PERCENTAGE_ALL",
                    title: "MEGA FLASH SALE! ‚ö°Ô∏è 20% OFF EVERYTHING!",
                    desc: "Hurry! This universal discount ends soon.",
                    discount: 0.20,
                    filter: () => true
                },
                // 2. Category Discount (e.g., Lip Products)
                {
                    type: "CATEGORY_PERCENTAGE",
                    title: "Pout Perfection! üíã 50% OFF ALL LIP PRODUCTS!",
                    desc: "All products in the 'Lip' category are half price.",
                    discount: 0.50,
                    filter: (p) => p.category === "Lip"
                },
                // 3. Category Discount (e.g., Skincare)
                {
                    type: "CATEGORY_PERCENTAGE",
                    title: "Skin Loving Care! üßñ‚Äç‚ôÄÔ∏è 25% OFF ALL SKINCARE!",
                    desc: "Pamper yourself with a discount on all 'Skincare' items.",
                    discount: 0.25,
                    filter: (p) => p.category === "Skincare"
                },
                // 4. BOGO on cheapest item in category
                {
                    type: "BOGO_CHEAPEST",
                    title: "Buy 2 Get 1 FREE on Eye Products! üëÄ",
                    desc: "Add 3 'Eyes' products to your cart, get the lowest-priced one free!",
                    category: "Eyes",
                    filter: (p) => p.category === "Eyes"
                },
                // 5. High-Value Specific Item Sale (50% off a specific high-value item)
                {
                    type: "SPECIFIC_ITEM",
                    title: "Today's Secret Star! üåü 50% OFF Unicorn Horn Brush Set!",
                    desc: "The magical brush set is half price, only for today!",
                    productId: 19, // ID of Unicorn Horn Brush Set
                    filter: (p) => p.id === 19
                }
            ];
            // Randomly select one sale
            return sales[Math.floor(Math.random() * sales.length)];
        }

        function getDiscountedPrice(product) {
            if (currentSale.filter(product)) {
                if (currentSale.type === "PERCENTAGE_ALL" || currentSale.type === "CATEGORY_PERCENTAGE" || currentSale.type === "SPECIFIC_ITEM") {
                    const discountedPrice = product.price * (1 - currentSale.discount);
                    return {
                        price: discountedPrice,
                        isSale: true,
                        saleInfo: `${Math.round(currentSale.discount * 100)}% OFF!`
                    };
                }
            }
            return { price: product.price, isSale: false, saleInfo: null };
        }

        // --- RENDERING FUNCTIONS ---

        function renderProducts() {
            const productListElement = document.getElementById('product-list');
            productListElement.innerHTML = ''; // Clear previous products

            productData.forEach(product => {
                const { price: displayPrice, isSale, saleInfo } = getDiscountedPrice(product);

                const productCard = `
                    <div class="bg-white p-4 sm:p-5 rounded-xl shadow-lg border-2 ${isSale ? 'border-red-400' : 'border-pink-200'} transform hover:scale-[1.03] transition duration-300 relative">
                        ${isSale ? `<span class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-xl">${saleInfo}</span>` : ''}
                        <div class="text-4xl text-center mb-3">${product.icon}</div>
                        <h4 class="font-bold text-lg text-purple-700 truncate">${product.name}</h4>
                        <p class="text-xs text-gray-500 mb-2">${product.category}</p>
                        
                        <p class="text-xl font-extrabold text-pink-600 mb-3">
                            ${formatCurrency(displayPrice)}
                            ${isSale ? `<span class="text-sm font-normal text-gray-400 line-through ml-1">${formatCurrency(product.price)}</span>` : ''}
                        </p>
                        
                        <p class="text-sm text-gray-600 h-10 overflow-hidden mb-4">${product.desc}</p>

                        <button onclick="addToCart(${product.id})" class="w-full py-2 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition duration-200">
                            Add to Cart ‚ûï
                        </button>
                    </div>
                `;
                productListElement.insertAdjacentHTML('beforeend', productCard);
            });
        }

        function renderCart() {
            const cartItemsElement = document.getElementById('cart-items');
            cartItemsElement.innerHTML = '';
            document.getElementById('empty-cart-message').classList.add('hidden');
            
            if (cart.length === 0) {
                document.getElementById('empty-cart-message').classList.remove('hidden');
            }

            // Group items by ID and count quantity
            const itemMap = cart.reduce((acc, item) => {
                acc[item.id] = acc[item.id] || { ...item, quantity: 0 };
                acc[item.id].quantity++;
                return acc;
            }, {});

            Object.values(itemMap).forEach(item => {
                const cartItem = `
                    <div class="flex justify-between items-center p-2 bg-purple-50 rounded-lg">
                        <div class="flex items-center">
                            <span class="text-xl mr-2">${item.icon}</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">${item.name}</p>
                                <p class="text-xs text-gray-500">Qty: ${item.quantity} x ${formatCurrency(item.price)}</p>
                            </div>
                        </div>
                        <button onclick="removeFromCart(${item.id})" class="text-pink-500 hover:text-pink-700 text-lg leading-none transition duration-150">
                            &times;
                        </button>
                    </div>
                `;
                cartItemsElement.insertAdjacentHTML('beforeend', cartItem);
            });

            document.getElementById('cart-count').textContent = cart.length;
            calculateTotals();
        }

        function calculateTotals() {
            let subtotal = 0;
            let totalDiscount = 0;
            const itemsByCategory = {};

            // 1. Calculate the initial subtotal and apply standard percentage/specific item discounts
            const appliedCart = cart.map(item => {
                const productDetails = productData.find(p => p.id === item.id);
                const { price: discountedPrice, isSale } = getDiscountedPrice(productDetails);
                
                // Track items for BOGO calculation later
                itemsByCategory[productDetails.category] = itemsByCategory[productDetails.category] || [];
                itemsByCategory[productDetails.category].push({ price: discountedPrice, id: item.id });

                subtotal += productDetails.price; // Subtotal before any discount
                
                if (isSale) {
                    const itemDiscount = productDetails.price - discountedPrice;
                    totalDiscount += itemDiscount;
                    return { ...productDetails, finalPrice: discountedPrice };
                }
                return { ...productDetails, finalPrice: productDetails.price };
            });

            // 2. Apply BOGO sale if applicable
            if (currentSale.type === "BOGO_CHEAPEST" && itemsByCategory[currentSale.category]) {
                const relevantItems = itemsByCategory[currentSale.category].sort((a, b) => a.price - b.price);
                
                if (relevantItems.length >= 3) {
                    const freeItemsCount = Math.floor(relevantItems.length / 3);
                    
                    // The 'free' item is the cheapest one for every 3 items
                    for (let i = 0; i < freeItemsCount; i++) {
                        const freeItem = relevantItems[i];
                        totalDiscount += freeItem.price; // Add the cheapest item's price as a discount
                    }
                }
            }

            let finalTotal = subtotal - totalDiscount;
            if (finalTotal < 0) finalTotal = 0;

            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('discount').textContent = formatCurrency(totalDiscount);
            document.getElementById('total').textContent = formatCurrency(finalTotal);
        }

        // --- USER ACTIONS ---

        function addToCart(productId) {
            const product = productData.find(p => p.id === productId);
            if (product) {
                cart.push(product);
                renderCart();
                showModal('Item Added! ü•≥', `${product.icon} ${product.name} has been added to your cart! Check out the savings.`);
            }
        }

        function removeFromCart(productId) {
            // Find the index of the first item with the matching ID
            const indexToRemove = cart.findIndex(item => item.id === productId);
            if (indexToRemove > -1) {
                cart.splice(indexToRemove, 1);
                renderCart();
            }
        }

        function clearCart() {
            cart = [];
            renderCart();
            showModal('Cart Cleared üóëÔ∏è', 'Your shopping cart is now empty. Ready for new treasures!');
        }

        function checkout() {
            if (cart.length === 0) {
                showModal('Cannot Checkout üò¢', 'Please add items to your cart before checking out.');
                return;
            }
            
            calculateTotals(); // Final calculation just in case
            const total = document.getElementById('total').textContent;
            const discount = document.getElementById('discount').textContent;

            showModal('Checkout Complete! üí∞', 
                `Your order for ${cart.length} item(s) is ready! 
                Total Savings: ${discount}. 
                Final Price: ${total}. 
                Thank you for shopping! üéÄ`);
            
            cart = [];
            renderCart();
        }

        // --- INITIALIZATION ---

        function init() {
            // 1. Define the unique sale for this session
            currentSale = defineSale();

            // 2. Update the Sale Banner
            document.getElementById('sale-title').textContent = currentSale.title;
            document.getElementById('sale-description').textContent = currentSale.desc;

            // 3. Render Products (applying sale price)
            renderProducts();
            
            // 4. Render Cart (empty initially)
            renderCart();

            // Set up a simple persistence for the cart using sessionStorage (optional but nice)
            loadCart();
            window.addEventListener('beforeunload', saveCart);
        }

        // Basic persistence (using sessionStorage as local storage is often restricted)
        function saveCart() {
            sessionStorage.setItem('cosmeticsCart', JSON.stringify(cart.map(item => item.id)));
        }

        function loadCart() {
            const storedIds = sessionStorage.getItem('cosmeticsCart');
            if (storedIds) {
                try {
                    const ids = JSON.parse(storedIds);
                    cart = ids.map(id => productData.find(p => p.id === id)).filter(p => p);
                    renderCart();
                } catch (e) {
                    console.error("Failed to load cart from session storage:", e);
                    cart = [];
                    renderCart();
                }
            }
        }

        window.onload = init;
    </script>

</body></html>